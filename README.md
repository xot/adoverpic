---
title: Adoverpic - extracting LaTeX overpic commands from tags in .eps files
author: Jaap-Henk Hoepman
---

# Introduction

A clean way to include LaTeX typesetting (e.g. equations) within figures is the `overpic` package. For example

	\begin{figure}
	  \begin{overpic}[abs,unit=1mm]{figure.eps} 
	  \put(0,39){\f}
	  \end{overpic}
	\end{figure}

takes the .eps figure in `figure.eps` and overlays the output of the (elsewhere defined) LaTeX command `\f` on top of that figure at the coordinates $(0,39)$.

It would be nice to be able to automatically generate the coordinates (and the LaTeX commands) from the figures themselves. That is to say: it would be nice to be able to add special strings (called *tags*) that signal that the string in question should be interpreted as a LaTeX command, whose output should be put at the location where the tag appears in the figure. Moreover, the tags themselves should be removed from the figure (so that they do not interfere with the output generated by the LaTeX commands).

# Background: Affinity Designer

Affinity Designer, when exporting a figure in encapsulated postscript (using EPS (for export) mode), generates the outlines for each text string in the figure prepended with a comment containing the text string itself. For example, when the figure contains the text string `\frac{1}{n}`, part of the exported encapsulated postscript output looks like

	% \frac{1}{n}
	51.421 1.104 m
	51.421 1.104 50.63 1.104 50.63 1.104 c
	50.63 1.104 48.13 9.409 48.13 9.409 c
 
where the first line (`51.421 1.104 m`) specifies the coordinates of the start of the string (in units that correspond to LateX's `pt`).

# Adoverpic

Adoverpic processes an encapsulated postscript file generated by Affinity Designer (in EPS (for export) mode) and searches for all occurrences of tags.
Such tags are text strings that start with a slash (i.e. like LaTeX commands). It creates a corresponding overpic `\put` command for these strings (using the coordinates found on the next line of the encapsulated postscript file), and writes these commands to an output file. For the encapsulated postscript file above it would generate the output

	\put(51.421,1.104){\frac{1}{n}}

Adoverpic also creates a copy of the input, but with all postscript code used to render the curves corresponding to the command strings found removed. Note that tags can be complex calls to LateX commands including parameters, as long as they do not contain whitespace.

To be precise, a line on the input that starts with `% \` followed by at least one non-whitespace character is considered to be a LaTeX command that needs to be converted to an overpic `\put` command. All non-whitespace characters following the slash (up to the first whitespace character, or a newline) are considered part of this LaTeX command. The next line of the input is assumed to contain two text strings (separated by a single space) that represent the real-valued x-coordinate and the y-coordinate respectively, in points.

# Usage

Run adoverpic as follows:

	adoverpic <eps-in-file> <eps-out-file> <overpic-out-file>

This processes the input file `<eps-in-file>` and transforms all tags to corresponding overpic commands written to `<overpic-out-file>`. The filtered output is stored in  `<eps-out-file>`. Adoverpic output is typically used as follows within a LaTeX document:

	\begin{figure}
	  \begin{overpic}[abs,unit=1pt]{<eps-out-file>} 
	  ... <definitions> ...
	  \input{<overpic-out-file>
	  \end{overpic}
    \end{figure}

# License

adoverpic is released under the [MIT](https://opensource.org/licenses/MIT) license. 
